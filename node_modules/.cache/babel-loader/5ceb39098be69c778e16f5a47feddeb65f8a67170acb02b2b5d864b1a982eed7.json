{"ast":null,"code":"import { getAuth, onAuthStateChanged } from 'firebase/auth';\nimport { getFirestore, collection, doc, getDoc, updateDoc, writeBatch, query, orderBy, getDocs, where } from 'firebase/firestore';\nimport SideBar from './SideBar.vue';\nimport TrendingPosts from './TrendingPosts.vue';\nimport WhoToFollow from './WhoToFollow.vue';\nimport TweetsList from './TweetsList.vue';\nexport default {\n  components: {\n    SideBar,\n    TrendingPosts,\n    WhoToFollow,\n    TweetsList\n  },\n  name: 'ProfilePage',\n  data() {\n    return {\n      tweets: [],\n      loading: true,\n      userID: null,\n      tweetsUpdateTime: Date.now(),\n      username: '',\n      updatingProfile: false,\n      tempUsername: '',\n      profileImage: '',\n      trendingTopics: [{\n        title: 'MLB',\n        subtitle: '2 hours ago'\n      }, {\n        title: 'Anthony Davis',\n        subtitle: '1,032 posts'\n      }],\n      usersToFollow: [{\n        name: 'AmazingAyo'\n      }]\n    };\n  },\n  methods: {\n    updateTweetLikedStatus({\n      tweetId,\n      status\n    }) {\n      const tweetToUpdate = this.tweets.find(tweet => tweet.id === tweetId);\n      if (tweetToUpdate) {\n        tweetToUpdate.liked = status;\n      }\n    },\n    updateTweetRepeatStatus({\n      tweetId,\n      status\n    }) {\n      const tweetToUpdate = this.tweets.find(tweet => tweet.id === tweetId);\n      if (tweetToUpdate) {\n        tweetToUpdate.repeated = status; // Make sure it's \"repeated\" not \"repeatd\"\n      }\n    },\n\n    async updateProfile() {\n      try {\n        this.updatingProfile = true;\n        const db = getFirestore();\n        const userDocRef = doc(db, 'users', this.userID);\n\n        // Update the username in Firestore\n        await updateDoc(userDocRef, {\n          username: this.tempUsername\n        });\n\n        // Update username in all the user's tweets\n        await this.updateUsernameInTweets(this.tempUsername);\n\n        // Update the local username property and re-fetch data\n        this.username = this.tempUsername;\n        await this.fetchTweets();\n\n        // Reset the tempUsername property\n        this.tempUsername = '';\n      } catch (error) {\n        console.error(\"Error updating profile:\", error);\n        // Handle the error, e.g., show an error message to the user\n      } finally {\n        this.updatingProfile = false;\n      }\n      await this.fetchTweets();\n      this.tweetsUpdateTime = Date.now();\n    },\n    async updateUsernameInTweets(newUsername) {\n      const db = getFirestore();\n      const tweetsQuery = query(collection(db, 'tweets'), where('userId', '==', this.userID));\n      const tweetDocs = await getDocs(tweetsQuery);\n      const batch = writeBatch(db); // Use a batch to update multiple documents at once\n\n      tweetDocs.forEach(docSnapshot => {\n        const tweetRef = doc(db, 'tweets', docSnapshot.id);\n        batch.update(tweetRef, {\n          username: newUsername\n        }); // Assuming 'username' is the field's name in tweets\n      });\n\n      await batch.commit();\n    },\n    async fetchUserProfile(userId) {\n      const db = getFirestore();\n      const userDocRef = doc(db, 'users', userId); // Adjust the path as needed\n      const userProfile = await getDoc(userDocRef);\n      if (userProfile.exists()) {\n        this.username = userProfile.data().username || ''; // Handle undefined username\n        this.profileImage = userProfile.data().profileImage || ''; // Handle undefined profileImage\n      } else {\n        console.error('User profile does not exist:', userId);\n      }\n    },\n    async fetchTweets() {\n      const db = getFirestore();\n      const tweetsCollection = collection(db, 'tweets');\n      const tweetsQuery = query(tweetsCollection, where('userId', '==', this.userID),\n      // Filter tweets by user ID\n      orderBy('timestamp', 'desc'));\n      const tweetDocs = await getDocs(tweetsQuery);\n      this.tweets = tweetDocs.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      console.log('Fetched tweets in parent:', this.tweets);\n    }\n  },\n  mounted() {\n    const auth = getAuth();\n    onAuthStateChanged(auth, async user => {\n      if (user) {\n        this.userID = user.uid;\n\n        // Fetch user profile and tweets\n        await this.fetchUserProfile(user.uid);\n        this.fetchTweets();\n        this.loading = false;\n      } else {\n        this.loading = false;\n        console.log('User is not authenticated');\n      }\n    });\n  }\n};","map":{"version":3,"names":["getAuth","onAuthStateChanged","getFirestore","collection","doc","getDoc","updateDoc","writeBatch","query","orderBy","getDocs","where","SideBar","TrendingPosts","WhoToFollow","TweetsList","components","name","data","tweets","loading","userID","tweetsUpdateTime","Date","now","username","updatingProfile","tempUsername","profileImage","trendingTopics","title","subtitle","usersToFollow","methods","updateTweetLikedStatus","tweetId","status","tweetToUpdate","find","tweet","id","liked","updateTweetRepeatStatus","repeated","updateProfile","db","userDocRef","updateUsernameInTweets","fetchTweets","error","console","newUsername","tweetsQuery","tweetDocs","batch","forEach","docSnapshot","tweetRef","update","commit","fetchUserProfile","userId","userProfile","exists","tweetsCollection","docs","map","log","mounted","auth","user","uid"],"sources":["/Users/kharelthompson/Coding/tc23/src/components/Profile.vue"],"sourcesContent":["<template>\n  <div>\n    <v-row v-if=\"loading\">\n      <v-col class=\"text-center\">\n        Loading...\n      </v-col>\n    </v-row>\n\n    <!-- Your existing content wrapped in a v-else -->\n    <v-row v-else>\n      <v-row>\n        <v-col cols=\"3\">\n          <SideBar />\n        </v-col>\n        <v-col cols=\"6\">\n          \n<br>\n\n  <v-row>\n          <!-- Profile Picture -->\n           <v-avatar v-if=\"profileImage\">\n            <img :src=\"profileImage\" alt=\"Profile\" width=\"100\" />\n          </v-avatar>\n </v-row>\n<v-row>\n          <!-- Username -->\n          <strong>@{{ username }}</strong>\n    </v-row>\n\n          <br><br>\n          \n          <!-- Row for Username input, Image Upload icon, and Update button -->\n          <v-row>\n\n          <!-- Column for Image Upload icon -->\n            <v-col cols=\"1\">\n              <label>\n                <v-icon>mdi-image</v-icon>\n                <input type=\"file\" @change=\"onFileChange\" style=\"display: none;\">\n              </label>\n            </v-col>\n\n            <!-- Column for Username input -->\n            <v-col cols=\"4\">\n              <input v-model=\"tempUsername\" placeholder=\"Choose a username\" />\n            </v-col>\n\n            <!-- Column for Update button -->\n            <v-col cols=\"3\">\n              <button @click=\"updateProfile\">Update Profile</button>\n            </v-col>\n          </v-row>\n\n<TweetsList \n  :tweets=\"tweets\" \n  @tweetLikedStatusUpdated=\"updateTweetLikedStatus\"\n  @tweetRepeatStatusUpdated=\"updateTweetRepeatStatus\"\n  @removeTweet=\"removeTweet\"\n  :key=\"tweetsUpdateTime\"\n/>\n        </v-col>\n\n        <v-col cols=\"3\">\n          <TrendingPosts :topics=\"trendingTopics\" class=\"sideB\" />\n          <WhoToFollow :users=\"usersToFollow\" class=\"sideB\" />\n        </v-col>\n      </v-row>\n    </v-row>\n  </div>\n</template>\n\n\n\n<script>\nimport { getAuth, onAuthStateChanged } from 'firebase/auth';\nimport { getFirestore, collection, doc, getDoc, updateDoc, writeBatch, query, orderBy, getDocs, where } from 'firebase/firestore';\n\nimport SideBar from './SideBar.vue';\nimport TrendingPosts from './TrendingPosts.vue';\nimport WhoToFollow from './WhoToFollow.vue';\nimport TweetsList from './TweetsList.vue';\n\n\n\n\n\nexport default {\n  components: {\n    SideBar,\n    TrendingPosts,\n    WhoToFollow,\n    TweetsList\n  },\n  name: 'ProfilePage',\n  data() {\n    return {\n      tweets: [],\n      loading: true,\n      userID: null,\n      tweetsUpdateTime: Date.now(),\n      username: '',\n      updatingProfile: false,\n       tempUsername: '',\n      profileImage: '',\n      trendingTopics: [\n        { title: 'MLB', subtitle: '2 hours ago' },\n        { title: 'Anthony Davis', subtitle: '1,032 posts' },\n      ],\n      usersToFollow: [{ name: 'AmazingAyo' }],\n    };\n  },\n  methods: {\n        updateTweetLikedStatus({ tweetId, status }) {\n  const tweetToUpdate = this.tweets.find(tweet => tweet.id === tweetId);\n  if (tweetToUpdate) {\n    tweetToUpdate.liked = status;\n  }\n},\nupdateTweetRepeatStatus({ tweetId, status }) {\n  const tweetToUpdate = this.tweets.find(tweet => tweet.id === tweetId);\n  if (tweetToUpdate) {\n    tweetToUpdate.repeated = status;  // Make sure it's \"repeated\" not \"repeatd\"\n  }\n},\n  \n        async updateProfile() {\n            try {\n                this.updatingProfile = true;\n\n                const db = getFirestore();\n                const userDocRef = doc(db, 'users', this.userID);\n\n                // Update the username in Firestore\n                await updateDoc(userDocRef, {\n                    username: this.tempUsername\n                });\n\n                // Update username in all the user's tweets\n                await this.updateUsernameInTweets(this.tempUsername);\n\n                // Update the local username property and re-fetch data\n                this.username = this.tempUsername;\n                await this.fetchTweets();\n\n                // Reset the tempUsername property\n                this.tempUsername = '';\n\n            } catch (error) {\n                console.error(\"Error updating profile:\", error);\n                // Handle the error, e.g., show an error message to the user\n            } finally {\n                this.updatingProfile = false;\n            }\n             await this.fetchTweets();\n            this.tweetsUpdateTime = Date.now();\n        },\n\n        async updateUsernameInTweets(newUsername) {\n            const db = getFirestore();\n            const tweetsQuery = query(\n                collection(db, 'tweets'),\n                where('userId', '==', this.userID)\n            );\n\n            const tweetDocs = await getDocs(tweetsQuery);\n\n            const batch = writeBatch(db); // Use a batch to update multiple documents at once\n\n            tweetDocs.forEach((docSnapshot) => {\n                const tweetRef = doc(db, 'tweets', docSnapshot.id);\n                batch.update(tweetRef, { username: newUsername }); // Assuming 'username' is the field's name in tweets\n            });\n\n            await batch.commit();\n        },\n    async fetchUserProfile(userId) {\n      const db = getFirestore();\n      const userDocRef = doc(db, 'users', userId); // Adjust the path as needed\n      const userProfile = await getDoc(userDocRef);\n\n      if (userProfile.exists()) {\n        this.username = userProfile.data().username || ''; // Handle undefined username\n        this.profileImage = userProfile.data().profileImage || ''; // Handle undefined profileImage\n      } else {\n        console.error('User profile does not exist:', userId);\n      }\n    },\n  async fetchTweets() {\n  const db = getFirestore();\n  const tweetsCollection = collection(db, 'tweets');\n  const tweetsQuery = query(\n    tweetsCollection,\n    where('userId', '==', this.userID), // Filter tweets by user ID\n    orderBy('timestamp', 'desc')\n  );\n\n  const tweetDocs = await getDocs(tweetsQuery);\n  this.tweets = tweetDocs.docs.map((doc) => ({\n    id: doc.id,\n    ...doc.data(),\n  }));\n  console.log('Fetched tweets in parent:', this.tweets);\n},\n\n  },\n  mounted() {\n    const auth = getAuth();\n    onAuthStateChanged(auth, async (user) => {\n      if (user) {\n        this.userID = user.uid;\n\n        // Fetch user profile and tweets\n        await this.fetchUserProfile(user.uid);\n        this.fetchTweets();\n\n        this.loading = false;\n      } else {\n        this.loading = false;\n        console.log('User is not authenticated');\n      }\n    });\n  },\n};\n</script>\n\n\n\n<style scoped>\n.sideB {\n  margin-bottom: 30px;\n  border: 1px solid #e0e0e0;\n  padding: 0px 10px;\n  margin-top: 0px;\n  border-radius: 5px;\n}\n\n/* ... other styles ... */\n\nbutton {\n    background-color: gray;\n    color: white;\n    padding: 5px 5px;\n    border-radius: 4px;\n    cursor: pointer;\n    transition: background-color 0.3s ease;\n}\n\nbutton:hover {\n\n}\n\n</style>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}